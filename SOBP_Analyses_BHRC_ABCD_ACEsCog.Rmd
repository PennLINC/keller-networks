---
title: "SOBP_Analyses_BHRC_ABCD_ACEsCog"
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(width=250)
library(tidyr)
library(dplyr)
library(ggplot2)
library(lsr)
library(lme4)
library(lmerTest)
```

## The goal of these analyses will be to compare ACEs (particularly Threat experiences) to cognition in two samples, the Brazilian High-Risk Cohort (BHRC) and the Adolescent Brain and Cognitive Development (ABCD) study. Here I will collect and organize results with the intention of submitting for SOBP. 

## ~~~~~~~~ BHRC ~~~~~~~~

### Load and organize data:
```{r}
# Load and combine dataframes
sle_factors<-readRDS("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/BHRC/thdp_20212904.rds")
ant_scores<-read.csv("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/BHRC/ANT SCORES 100-1700ms RT cutoffs.csv")
demo_data<-read.csv("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/BHRC/BHRCS_w0_Arielle.csv")
proposal.data<-readRDS("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/BHRC/PhD_117BHRC_2021_10_02.rds") 
colnames(sle_factors)[2]<-"SUBJECTID"
colnames(demo_data)[2]<-"SUBJECTID"
combined.data1<-merge(demo_data,ant_scores,by="SUBJECTID")
proposal.data.w0<-proposal.data[proposal.data$redcap_event_name=="wave0_arm_1",c("ident", setdiff(colnames(proposal.data),colnames(combined.data1)))]
combined.data2<-merge(proposal.data.w0,sle_factors,by="ident")
all.data<-merge(combined.data1,combined.data2,by="SUBJECTID")
all.data$gender<-as.factor(all.data$gender)
all.data<-all.data[!is.na(all.data$gender),] #make sure gender variable is available for all participants

# Remove outliers (>3sd) on Alerting, Orienting, and Conflict scores
ALERT.3sd <- sd(all.data[!is.na(all.data$ALERT),]$ALERT)*3
ORIENT.3sd <- sd(all.data[!is.na(all.data$ORIENT),]$ORIENT)*3
CONFLICT.3sd <- sd(all.data[!is.na(all.data$CONFLICT),]$CONFLICT)*3
ALERT.mean <- mean(all.data[!is.na(all.data$ALERT),]$ALERT)
ORIENT.mean <- mean(all.data[!is.na(all.data$ORIENT),]$ORIENT)
CONFLICT.mean <- mean(all.data[!is.na(all.data$CONFLICT),]$CONFLICT)

# These will be separate data structures retaining as many subjects as possible for each of the 3 performance metrics
all.data.ALERT <- all.data[(all.data$ALERT>(ALERT.mean-ALERT.3sd) & all.data$ALERT<(ALERT.mean+ALERT.3sd)),]
all.data.ORIENT <- all.data[(all.data$ORIENT>(ORIENT.mean-ORIENT.3sd) & all.data$ORIENT<(ORIENT.mean+ORIENT.3sd)),]
all.data.CONFLICT <- all.data[(all.data$CONFLICT>(CONFLICT.mean-CONFLICT.3sd) & all.data$CONFLICT<(CONFLICT.mean+CONFLICT.3sd)),]

# This is a complete set with subjects who have all 3 measures within the bounds of 3SD
all.data.complete.set <- all.data[(all.data$ALERT>(ALERT.mean-ALERT.3sd) & all.data$ALERT<(ALERT.mean+ALERT.3sd)) & (all.data$ORIENT>(ORIENT.mean-ORIENT.3sd) & all.data$ORIENT<(ORIENT.mean+ORIENT.3sd)) & (all.data$CONFLICT>(CONFLICT.mean-CONFLICT.3sd) & all.data$CONFLICT<(CONFLICT.mean+CONFLICT.3sd)),]

```


### Threat and deprivation scores are correlated at r=0.39
```{r}
cor.test(all.data.complete.set$threat,all.data.complete.set$depriv)
```


### Run linear models using Threat and Deprivation scores to predict ANT performance metrics
# Note: Gender 1 = Male, Gender 2 = Female
# Key observation: females with greater experiences of Threat have worse Alerting scores
```{r}
summary(lm(ALERT~age+gender+threat+depriv+gender*threat+gender*depriv,data=all.data.ALERT)) #Threat x Gender 0.048*
summary(lm(ORIENT~age+gender+threat+depriv+gender*threat+gender*depriv,data=all.data.complete.set)) #ns
summary(lm(CONFLICT~age+gender+threat+depriv+gender*threat+gender*depriv,data=all.data.complete.set)) #ns

ggplot(data=all.data.ALERT[!is.na(all.data.ALERT$gender),],aes(threat,ALERT))+geom_point(size=1,colour=all.data.ALERT[!is.na(all.data.ALERT$gender),]$age)+geom_smooth(method=lm)+ facet_wrap(~ factor(gender,labels=c("Male","Female")))

all.data.ALERT$threat.binary <- factor(all.data.ALERT$threat>0,labels = c("More Threat","Less Threat"))

df.summary <- all.data.ALERT %>%
     group_by(threat.binary,gender) %>%
     summarise(
         se = sd(ALERT, na.rm = TRUE)/sqrt(length(ALERT)),
         ALERT = mean(ALERT))
ggplot(data=df.summary, aes(x=gender,y=ALERT,fill=as.factor(interaction(threat.binary,gender)))) +
  geom_bar(stat="identity",position="dodge") + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) +xlab("Gender") + ylab("ALERT") + geom_errorbar(aes(ymin=ALERT-se, ymax=ALERT+se), width=.2,position=position_dodge(.9))+coord_cartesian(ylim=c(0,100))


```

## ~~~~~~~~ ABCD ~~~~~~~~

### Load and organize data:
```{r}
nihtb<-read.table("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/NihTB/abcd_tbss01.txt",header=TRUE)
nihtb.baseline<-nihtb[nihtb$eventname=="baseline_year_1_arm_1",]
lmt<-read.table("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/Thomp/lmtp201.txt",header=TRUE)
lmt.baseline<-lmt[lmt$eventname=="baseline_year_1_arm_1",]
merged.data2 <- merge(nihtb.baseline,lmt.baseline[, c("subjectkey", setdiff(colnames(lmt.baseline),colnames(nihtb.baseline)))],by="subjectkey")
ravlt<-read.table("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/Thomp/abcd_ps01.txt",header=TRUE)
ravlt.baseline<-ravlt[ravlt$eventname=="baseline_year_1_arm_1",]
merged.data3 <- merge(merged.data2,ravlt.baseline[, c("subjectkey", setdiff(colnames(ravlt.baseline),colnames(merged.data2)))],by="subjectkey")
trauma<-read.table("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/Strife/abcd_ptsd01.txt",header=TRUE)
trauma.baseline<-trauma[trauma$eventname=="baseline_year_1_arm_1",]
combined.data <- merge(merged.data3,trauma.baseline[, c("subjectkey", setdiff(colnames(trauma.baseline),colnames(merged.data3)))],by="subjectkey")
combined.data$nihtbx_flanker_uncorrected <- as.numeric(combined.data$nihtbx_flanker_uncorrected)
combined.data$nihtbx_picvocab_uncorrected <- as.numeric(combined.data$nihtbx_picvocab_uncorrected)
combined.data$nihtbx_list_uncorrected <- as.numeric(combined.data$nihtbx_list_uncorrected)
combined.data$nihtbx_pattern_uncorrected <- as.numeric(combined.data$nihtbx_pattern_uncorrected)
combined.data$nihtbx_cardsort_uncorrected <- as.numeric(combined.data$nihtbx_cardsort_uncorrected)
combined.data$nihtbx_picture_uncorrected <- as.numeric(combined.data$nihtbx_picture_uncorrected)
combined.data$nihtbx_reading_uncorrected <- as.numeric(combined.data$nihtbx_reading_uncorrected)
combined.data$lmt_scr_perc_correct <- as.numeric(combined.data$lmt_scr_perc_correct)
combined.data$pea_ravlt_sd_trial_i_tc <- as.numeric(combined.data$pea_ravlt_sd_trial_i_tc)
combined.data$pea_ravlt_sd_trial_ii_tc <- as.numeric(combined.data$pea_ravlt_sd_trial_ii_tc)
combined.data$pea_ravlt_sd_trial_iii_tc <- as.numeric(combined.data$pea_ravlt_sd_trial_iii_tc)
combined.data$pea_ravlt_sd_trial_iv_tc <- as.numeric(combined.data$pea_ravlt_sd_trial_iv_tc)
combined.data$pea_ravlt_sd_trial_v_tc <- as.numeric(combined.data$pea_ravlt_sd_trial_v_tc)
combined.data$interview_age <- as.numeric(combined.data$interview_age)

ind_pea_ravlt = c(which(names(combined.data)=="pea_ravlt_sd_trial_i_tc"),which(names(combined.data)=="pea_ravlt_sd_trial_ii_tc"),
	which(names(combined.data)=="pea_ravlt_sd_trial_iii_tc"),which(names(combined.data)=="pea_ravlt_sd_trial_iv_tc"),
	which(names(combined.data)=="pea_ravlt_sd_trial_v_tc")); names(combined.data)[ind_pea_ravlt]; summary(combined.data[,ind_pea_ravlt])
combined.data$pea_ravlt_ld = apply(combined.data[,ind_pea_ravlt],1,sum)

combined.data$pea_ravlt_ld <- as.numeric(combined.data$pea_ravlt_ld)

# Rename according to Thompson 2018 code
names(combined.data)[which(names(combined.data)=="nihtbx_picvocab_uncorrected")] = "PicVocab"
names(combined.data)[which(names(combined.data)=="nihtbx_flanker_uncorrected")] = "Flanker"
names(combined.data)[which(names(combined.data)=="nihtbx_list_uncorrected")] = "List"
names(combined.data)[which(names(combined.data)=="nihtbx_cardsort_uncorrected")] = "CardSort"
names(combined.data)[which(names(combined.data)=="nihtbx_pattern_uncorrected")] = "Pattern"
names(combined.data)[which(names(combined.data)=="nihtbx_picture_uncorrected")] = "Picture"
names(combined.data)[which(names(combined.data)=="nihtbx_reading_uncorrected")] = "Reading"
names(combined.data)[which(names(combined.data)=="pea_ravlt_ld")] = "RAVLT"
names(combined.data)[which(names(combined.data)=="lmt_scr_perc_correct")] = "LMT"
```


# Calculate Thompson factor scores and remove outliers
```{r}
combined.data$thompson_PC1 <- (0.754*combined.data$PicVocab)+(0.213*combined.data$Flanker)+(0.471*combined.data$List)+(0.205*combined.data$CardSort)+(0.015*combined.data$Pattern)+(0.012*combined.data$Picture)+(0.82*combined.data$Reading)+(0.306*combined.data$RAVLT)+(0.5*combined.data$LMT)

combined.data$thompson_PC2 <- (0.065*combined.data$PicVocab)+(0.712*combined.data$Flanker)+(0.148*combined.data$List)+(0.71*combined.data$CardSort)+(0.813*combined.data$Pattern)+(0.135*combined.data$Picture)+(0.12*combined.data$Reading)+(0.125*combined.data$RAVLT)+(0.299*combined.data$LMT)

combined.data$thompson_PC3 <- (0.19*combined.data$PicVocab)+(0.067*combined.data$Flanker)+(0.493*combined.data$List)+(0.232*combined.data$CardSort)+(0.085*combined.data$Pattern)+(0.863*combined.data$Picture)+(0.122*combined.data$Reading)+(0.712*combined.data$RAVLT)+(0.068*combined.data$LMT)

mean_PC1 <- mean(combined.data$thompson_PC1,na.rm=TRUE)
mean_PC2 <- mean(combined.data$thompson_PC2,na.rm=TRUE)
mean_PC3 <- mean(combined.data$thompson_PC3,na.rm=TRUE)
sd3_PC1 <- sd(combined.data$thompson_PC1,na.rm=TRUE)*3
sd3_PC2 <- sd(combined.data$thompson_PC2,na.rm=TRUE)*3
sd3_PC3 <- sd(combined.data$thompson_PC3,na.rm=TRUE)*3
sum(combined.data$thompson_PC1 > mean_PC1+sd3_PC1,na.rm=TRUE) # 10 outliers
sum(combined.data$thompson_PC2 > mean_PC2+sd3_PC2,na.rm=TRUE) # 3 outliers
sum(combined.data$thompson_PC3 > mean_PC3+sd3_PC3,na.rm=TRUE) # 2 outliers

combined.data.noOutliers <- combined.data[(combined.data$thompson_PC1>(mean_PC1-sd3_PC1) & combined.data$thompson_PC1<(mean_PC1+sd3_PC1) & combined.data$thompson_PC2>(mean_PC2-sd3_PC2) & combined.data$thompson_PC2<(mean_PC2+sd3_PC2) & combined.data$thompson_PC3>(mean_PC3-sd3_PC3) & combined.data$thompson_PC3<(mean_PC3+sd3_PC3)),]
```


## Calculate types of ACEs
```{r}
combined.data.noOutliers[,224:240]<-as.numeric(unlist(combined.data.noOutliers[,224:240]))

# Calculation of subscore with items related to physical and sexual abuse
combined.data.noOutliers$abuse <- rowSums(data.frame(as.numeric(combined.data.noOutliers$ksads_ptsd_raw_761_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_762_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_763_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_767_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_768_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_769_p)),na.rm=TRUE)

# Calculation of subscore with items related to trauma (car accidents, natural disasters, loss, etc.)
combined.data.noOutliers$trauma <- rowSums(data.frame(as.numeric(combined.data.noOutliers$ksads_ptsd_raw_754_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_755_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_756_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_757_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_758_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_759_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_760_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_766_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_770_p)),na.rm=TRUE)

# Calculation of total score from the KSADS items
combined.data.noOutliers$totalACEs <- rowSums(data.frame(as.numeric(combined.data.noOutliers$ksads_ptsd_raw_754_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_755_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_756_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_757_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_758_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_759_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_760_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_761_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_762_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_763_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_764_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_765_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_766_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_767_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_768_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_769_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_770_p)),na.rm=TRUE)

# Remember to add in this variable about family structure so we can use it as a covariate
family <-read.table("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/ses/acspsw03.txt",header=TRUE)
family.baseline<-family[family$eventname=="baseline_year_1_arm_1",]
abcd.data <- merge(combined.data.noOutliers,family.baseline[, c("subjectkey", setdiff(colnames(family.baseline),colnames(combined.data.noOutliers)))],by="subjectkey")

emo.neglect <-read.table("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/neglect/crpbi01.txt",header=TRUE)
emo.neglect.baseline<-emo.neglect[emo.neglect$eventname=="baseline_year_1_arm_1",]
phy.neglect <-read.table("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/neglect/pmq01.txt",header=TRUE)
phy.neglect.baseline<-phy.neglect[phy.neglect$eventname=="baseline_year_1_arm_1",]
neglect.data <- merge(emo.neglect.baseline,phy.neglect.baseline[, c("subjectkey", setdiff(colnames(phy.neglect.baseline),colnames(emo.neglect.baseline)))],by="subjectkey")

abcd.data<-merge(abcd.data,neglect.data[,c("subjectkey", setdiff(colnames(neglect.data),colnames(abcd.data)))],by="subjectkey")

# Calculate subscales of deprivation (emotional and physical neglect) - see this ref for motivation https://www.sciencedirect.com/science/article/pii/S2352289518300821
abcd.data$acceptance <- rowSums(data.frame(as.numeric(abcd.data$crpbi_parent1_y),as.numeric(abcd.data$crpbi_parent2_y),as.numeric(abcd.data$crpbi_parent3_y),as.numeric(abcd.data$crpbi_parent4_y),as.numeric(abcd.data$crpbi_parent5_y)))

abcd.data$monitoring <- rowSums(data.frame(as.numeric(abcd.data$parent_monitor_q1_y),as.numeric(abcd.data$parent_monitor_q2_y),as.numeric(abcd.data$parent_monitor_q3_y),as.numeric(abcd.data$parent_monitor_q4_y),as.numeric(abcd.data$parent_monitor_q5_y)))
```


## Binarize the four ACEs subtypes (2 "Threat" types: Abuse and Trauma; 2 "Deprivation" types: Emotional Neglect and Physical Neglect)

```{r}
abcd.data$abuse.binary <- factor(abcd.data$abuse>=1,labels = c("No Abuse","Abuse"))
abcd.data$abuse.binary.numeric <- as.numeric(abcd.data$abuse.binary)
abcd.data$trauma.binary <- factor(abcd.data$trauma>=1,labels = c("No Trauma","Trauma"))
abcd.data$trauma.binary.numeric <- as.numeric(abcd.data$trauma.binary)

median.monitoring = median(na.omit(abcd.data$monitoring))
median.acceptance = median(na.omit(abcd.data$acceptance))
abcd.data$monitoring.binary <- factor(abcd.data$monitoring<20,labels = c("Low Physical Neglect","High Physical Neglect"))
abcd.data$monitoring.binary.numeric <- as.numeric(abcd.data$monitoring.binary)
abcd.data$acceptance.binary <- factor(abcd.data$acceptance<7.5,labels = c("Low Emotional Neglect","High Emotional Neglect"))
abcd.data$acceptance.binary.numeric <- as.numeric(abcd.data$acceptance.binary)
```


## Plot everything
```{r}

data.long <- gather(abcd.data, CogType, CogScore, thompson_PC1,thompson_PC2,thompson_PC3, factor_key=TRUE)
abcd.long <- gather(data.long, ACEsType, ACEsScore, acceptance.binary.numeric,monitoring.binary.numeric,abuse.binary.numeric,trauma.binary.numeric, factor_key=TRUE)

abcd.long.complete <- abcd.long[complete.cases(abcd.long[,c("CogType","CogScore","ACEsType","ACEsScore")]),c("CogType","CogScore","ACEsType","ACEsScore","interview_age","sex","rel_family_id")]

ggplot(data=abcd.long.complete, aes(x=ACEsScore,y=CogScore,fill=interaction(ACEsType,CogType))) +
  geom_bar(stat="identity",position="dodge") + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) +xlab("ACEs") + ylab("Cognition") +coord_cartesian(ylim=c(250,325)) + facet_grid(abcd.long.complete$ACEsType~abcd.long.complete$CogType)


```




## Run linear mixed effects models!
```{r}

summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+acceptance.binary+monitoring.binary+abuse.binary+trauma.binary,data=abcd.data))
p.adjust(c(0.615, 2e-16,0.035,6.96e-11),method="bonferroni")

summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+acceptance.binary+monitoring.binary+abuse.binary+trauma.binary,data=abcd.data))
p.adjust(c(0.389, 7.47e-15,0.0096,4.39e-7),method="bonferroni")

summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+acceptance.binary+monitoring.binary+abuse.binary+trauma.binary,data=abcd.data))
p.adjust(c(0.034, 2e-16,0.014,6.18e-8),method="bonferroni")


summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+monitoring.binary+monitoring.binary*sex,data=abcd.data))
summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+monitoring.binary+monitoring.binary*sex,data=abcd.data))
summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+monitoring.binary+monitoring.binary*sex,data=abcd.data))

summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+abuse.binary+abuse.binary*sex,data=abcd.data))
summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+abuse.binary+abuse.binary*sex,data=abcd.data))
summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+abuse.binary+abuse.binary*sex,data=abcd.data))

summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+trauma.binary+trauma.binary*sex,data=abcd.data))
summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+trauma.binary+trauma.binary*sex,data=abcd.data))
summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+trauma.binary+trauma.binary*sex,data=abcd.data))

summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+acceptance.binary+acceptance.binary*sex,data=abcd.data))


summary(lmer(CogScore~interview_age+sex+(1|rel_family_id)+acceptance.binary+CogType+CogType*acceptance.binary,data=data.long))
summary(lmer(CogScore~interview_age+sex+(1|rel_family_id)+monitoring.binary+CogType+CogType*monitoring.binary,data=data.long))
summary(lmer(CogScore~interview_age+sex+(1|rel_family_id)+abuse.binary+CogType+CogType*abuse.binary,data=data.long))
summary(lmer(CogScore~interview_age+sex+(1|rel_family_id)+trauma.binary+CogType+CogType*trauma.binary,data=data.long))




summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+acceptance.binary,data=abcd.data))
summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+monitoring.binary,data=abcd.data))
summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+abuse.binary,data=abcd.data))
summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+trauma.binary,data=abcd.data))

summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+acceptance.binary,data=abcd.data))
summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+monitoring.binary,data=abcd.data))
summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+abuse.binary,data=abcd.data))
summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+trauma.binary,data=abcd.data))

summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+acceptance.binary,data=abcd.data))
summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+monitoring.binary,data=abcd.data))
summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+abuse.binary,data=abcd.data))
summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+trauma.binary,data=abcd.data))

```




# sandbox
```{r}

ggplot(data=abcd.data,aes(totalACEs,thompson_PC2))+geom_point(size=1,colour=abcd.data$interview_age)+geom_smooth(method=lm)+ facet_wrap(~ factor(sex,labels=c("Male","Female")))

df.summary <- abcd.data %>%
     group_by(ACEs.binary,sex) %>%
     summarise(
         se = sd(thompson_PC2, na.rm = TRUE)/sqrt(length(thompson_PC2)),
         thompson_PC2 = mean(thompson_PC2))
ggplot(data=df.summary, aes(x=sex,y=thompson_PC2,fill=as.factor(interaction(ACEs.binary,sex)))) +
  geom_bar(stat="identity",position="dodge") + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) +xlab("Sex") + ylab("thompson_PC2") + geom_errorbar(aes(ymin=thompson_PC2-se, ymax=thompson_PC2+se), width=.2,position=position_dodge(.9))+coord_cartesian(ylim=c(240,265))


df.summary <- abcd.data %>%
     group_by(ACEs.binary,sex) %>%
     summarise(
         se = sd(thompson_PC1, na.rm = TRUE)/sqrt(length(thompson_PC1)),
         thompson_PC1 = mean(thompson_PC1))
ggplot(data=df.summary, aes(x=sex,y=thompson_PC1,fill=as.factor(interaction(ACEs.binary,sex)))) +
  geom_bar(stat="identity",position="dodge") + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) +xlab("Sex") + ylab("thompson_PC1") + geom_errorbar(aes(ymin=thompson_PC1-se, ymax=thompson_PC1+se), width=.2,position=position_dodge(.9))+coord_cartesian(ylim=c(220,245))


df.summary <- abcd.data %>%
     group_by(ACEs.binary,sex) %>%
     summarise(
         se = sd(thompson_PC3, na.rm = TRUE)/sqrt(length(thompson_PC3)),
         thompson_PC3 = mean(thompson_PC3))
ggplot(data=df.summary, aes(x=sex,y=thompson_PC3,fill=as.factor(interaction(ACEs.binary,sex)))) +
  geom_bar(stat="identity",position="dodge") + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) +xlab("Sex") + ylab("thompson_PC3") + geom_errorbar(aes(ymin=thompson_PC3-se, ymax=thompson_PC3+se), width=.2,position=position_dodge(.9))+coord_cartesian(ylim=c(220,245))



summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+ACEs.binary+ACEs.binary*interview_age,data=abcd.data))
summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+ACEs.binary+ACEs.binary*interview_age,data=abcd.data))
summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+ACEs.binary+ACEs.binary*interview_age,data=abcd.data))


abcd.data$agesRounded <- round(abcd.data$interview_age)
df.summary <- abcd.data %>%
     group_by(ACEs.binary,sex,agesRounded) %>%
     summarise(
         se = sd(thompson_PC1, na.rm = TRUE)/sqrt(length(thompson_PC1)),
         thompson_PC1 = mean(thompson_PC1))
ggplot(data=df.summary, aes(x=sex,y=thompson_PC1,fill=as.factor(interaction(ACEs.binary,sex)))) +
  geom_bar(stat="identity",position="dodge") + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) +xlab("Sex") + ylab("thompson_PC1") + geom_errorbar(aes(ymin=thompson_PC1-se, ymax=thompson_PC1+se), width=.2,position=position_dodge(.9))+ facet_wrap(~ factor(round(agesRounded)))

df.summary <- abcd.data %>%
     group_by(ACEs.binary,agesRounded) %>%
     summarise(
         se = sd(thompson_PC1, na.rm = TRUE)/sqrt(length(thompson_PC1)),
         thompson_PC1 = mean(thompson_PC1))
ggplot(data=df.summary, aes(x=ACEs.binary,y=thompson_PC1)) +
  geom_bar(stat="identity",position="dodge") + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) +xlab("ACEs") + ylab("thompson_PC1") + geom_errorbar(aes(ymin=thompson_PC1-se, ymax=thompson_PC1+se), width=.2,position=position_dodge(.9))+ facet_wrap(~ factor(round(agesRounded)))+coord_cartesian(ylim=c(210,255))


df.summary <- abcd.long %>%
     group_by(ACEsType,ACEsScore,CogType) %>%
     summarise(
         se = sd(CogScore, na.rm = TRUE)/sqrt(length(CogScore)),
         CogScore = mean(na.omit(CogScore)))
ggplot(data=df.summary, aes(x=ACEsScore,y=CogScore,fill=interaction(ACEsType,CogType))) + geom_bar(stat="identity",position="dodge") + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),panel.background = element_blank(), axis.line = element_line(colour = "black")) +xlab("ACEs") + ylab("Cognition") +coord_cartesian(ylim=c(220,265)) + geom_errorbar(aes(ymin=CogScore-se, ymax=CogScore+se), width=.2,position=position_dodge(.9)) +  facet_grid(df.summary$ACEsType~df.summary$CogType)
```







