---
title: "PaperOutline_ACEsCog"
author: "Arielle Keller"
date: "12/14/2021"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(width=250)
library(tidyr)
library(dplyr)
library(ggplot2)
library(lsr)
library(lme4)
library(lmerTest)
library(ggcorrplot)
library(corrplot)
library(RColorBrewer)
```

# The goal of these analyses will be to compare ACEs (particularly Threat experiences) to cognition in two samples, the Brazilian High-Risk Cohort (BHRC) and the Adolescent Brain and Cognitive Development (ABCD) study. 

## ~~~~~~~~ BHRC ~~~~~~~~

### Load and organize data:
```{r}
# Load and combine dataframes
sle_factors<-readRDS("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/BHRC/thdp_20212904.rds")
#ant_scores<-read.csv("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/BHRC/ANT SCORES 100-1700ms RT cutoffs.csv")
demo_data<-read.csv("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/BHRC/BHRCS_w0_Arielle.csv")
proposal.data<-readRDS("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/BHRC/PhD_117BHRC_2021_10_02.rds") 
data_depriv_emoneg<-readRDS("/Users/ariellekeller/Downloads/Arielle_BHRC_2021_12_26_2.rds")
sle_and_depriv <- merge(sle_factors[,c(1,2,4,5)],data_depriv_emoneg,by="ident") #don't duplicate redcap event name
colnames(sle_and_depriv)[2]<-"SUBJECTID"
colnames(demo_data)[2]<-"SUBJECTID"
#combined.data1<-merge(demo_data,ant_scores,by="SUBJECTID")
proposal.data.w0<-proposal.data[proposal.data$redcap_event_name=="wave0_arm_1",c("ident", setdiff(colnames(proposal.data),colnames(demo_data)))]
combined.data2<-merge(proposal.data.w0,sle_and_depriv[,c("ident", setdiff(colnames(sle_and_depriv),colnames(proposal.data.w0)))],by="ident")
all.data<-merge(demo_data,combined.data2[,c("SUBJECTID", setdiff(colnames(combined.data2),colnames(demo_data)))],by="SUBJECTID")
all.data$gender<-as.factor(all.data$gender)
all.data<-all.data[!is.na(all.data$gender),] #make sure gender variable is available for all participants
# 
# # Remove outliers (>3sd) on Alerting, Orienting, and Conflict scores
# ALERT.3sd <- sd(all.data[!is.na(all.data$ALERT),]$ALERT)*3
# ORIENT.3sd <- sd(all.data[!is.na(all.data$ORIENT),]$ORIENT)*3
# CONFLICT.3sd <- sd(all.data[!is.na(all.data$CONFLICT),]$CONFLICT)*3
# ALERT.mean <- mean(all.data[!is.na(all.data$ALERT),]$ALERT)
# ORIENT.mean <- mean(all.data[!is.na(all.data$ORIENT),]$ORIENT)
# CONFLICT.mean <- mean(all.data[!is.na(all.data$CONFLICT),]$CONFLICT)
# 
# # These will be separate data structures retaining as many subjects as possible for each of the 3 performance metrics
# all.data.ALERT <- all.data[(all.data$ALERT>(ALERT.mean-ALERT.3sd) & all.data$ALERT<(ALERT.mean+ALERT.3sd)),]
# all.data.ORIENT <- all.data[(all.data$ORIENT>(ORIENT.mean-ORIENT.3sd) & all.data$ORIENT<(ORIENT.mean+ORIENT.3sd)),]
# all.data.CONFLICT <- all.data[(all.data$CONFLICT>(CONFLICT.mean-CONFLICT.3sd) & all.data$CONFLICT<(CONFLICT.mean+CONFLICT.3sd)),]
# 
# # This is a complete set with subjects who have all 3 measures within the bounds of 3SD
# all.data.complete.set <- all.data[(all.data$ALERT>(ALERT.mean-ALERT.3sd) & all.data$ALERT<(ALERT.mean+ALERT.3sd)) & (all.data$ORIENT>(ORIENT.mean-ORIENT.3sd) & all.data$ORIENT<(ORIENT.mean+ORIENT.3sd)) & (all.data$CONFLICT>(CONFLICT.mean-CONFLICT.3sd) & all.data$CONFLICT<(CONFLICT.mean+CONFLICT.3sd)),]

# Add new data for BHRC
new_cog_data<-readRDS("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/BHRC/BHRCS_Cog_IQ_TDE_w0.rds")
colnames(new_cog_data)[1]<-"SUBJECTID"
all.data.new<-merge(all.data,new_cog_data[,c("SUBJECTID", setdiff(colnames(new_cog_data),colnames(all.data)))],by="SUBJECTID")


```


```{r}
# Remove outliers (>3sd)
EF.3sd <- sd(all.data.new[!is.na(all.data.new$EF),]$EF)*3
WM.3sd <- sd(all.data.new[!is.na(all.data.new$WM),]$WM)*3
TP.3sd <- sd(all.data.new[!is.na(all.data.new$TP),]$TP)*3
IC.3sd <- sd(all.data.new[!is.na(all.data.new$IC),]$IC)*3
EF.mean <- mean(all.data.new[!is.na(all.data.new$EF),]$EF)
WM.mean <- mean(all.data.new[!is.na(all.data.new$WM),]$WM)
TP.mean <- mean(all.data.new[!is.na(all.data.new$TP),]$TP)
IC.mean <- mean(all.data.new[!is.na(all.data.new$IC),]$IC)

# This is a complete set with subjects who have all 4 cog measures within the bounds of 3SD
all.data.complete <- all.data.new[(all.data.new$EF>(EF.mean-EF.3sd) & all.data.new$EF<(EF.mean+EF.3sd)) & (all.data.new$WM>(WM.mean-WM.3sd) & all.data.new$WM<(WM.mean+WM.3sd)) & (all.data.new$IC>(IC.mean-IC.3sd) & all.data.new$IC<(IC.mean+IC.3sd)) & (all.data.new$TP>(TP.mean-TP.3sd) & all.data.new$TP<(TP.mean+TP.3sd)),]

```


## Run linear models using Threat and Deprivation scores to predict cognition
### Note: Gender 1 = Male, Gender 2 = Female
### Covariates for age, gender, and random effects for school and state


### Significant:
```{r}
# summary(lmer(EF~age+gender+(1|state)+(1|schoolID)+threat,data=all.data.new)) # ***
# summary(lmer(EF~age+gender+(1|state)+(1|schoolID)+depriv,data=all.data.new)) # ***
# 
# summary(lmer(WM~age+gender+(1|state)+(1|schoolID)+threat,data=all.data.new)) # * (does not pass correction)
# summary(lmer(WM~age+gender+(1|state)+(1|schoolID)+depriv,data=all.data.new)) # ***
# 
# summary(lmer(TP~age+gender+(1|state)+(1|schoolID)+threat,data=all.data.new)) # ***
# summary(lmer(TP~age+gender+(1|state)+(1|schoolID)+depriv,data=all.data.new)) # ***
# 
# p.adjust(c(0.000463,9.78e-07,0.0184,1.16e-07,0.000233,5.03e-06),method="bonferroni")

```


### Plots:
```{r}
# correlation <- cor.test(all.data.new$threat,all.data.new$WM)
# ggplot(data=all.data.new,aes(threat,WM))+geom_point(size=1,colour='#70677D')+geom_smooth(method=lm,colour='black')+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
# panel.background = element_blank(), axis.line = element_line(colour = "black")) +ylab('Working Memory') + xlab('Threat') + ggtitle(paste("r=",as.character(round(correlation$estimate,3)),", p=",as.character(round(correlation$p.value,3))))
# 
# correlation <- cor.test(all.data.new$depriv,all.data.new$WM)
# ggplot(data=all.data.new,aes(depriv,WM))+geom_point(size=1,colour='#7393C4')+geom_smooth(method=lm,colour='black')+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
# panel.background = element_blank(), axis.line = element_line(colour = "black")) +ylab('Working Memory') + xlab('Deprivation') + ggtitle(paste("r=",as.character(round(correlation$estimate,3)),", p=",as.character(round(correlation$p.value,3))))
```


### For the effects where there was also a significant effect of gender, look for an interaction (there are none)
```{r}
# summary(lmer(EF~age+gender+(1|state)+(1|schoolID)+threat+threat*gender,data=all.data.new)) # ns
# summary(lmer(EF~age+gender+(1|state)+(1|schoolID)+depriv+depriv*gender,data=all.data.new)) # ns
# 
# summary(lmer(TP~age+gender+(1|state)+(1|schoolID)+threat+threat*gender,data=all.data.new)) # ns
# summary(lmer(TP~age+gender+(1|state)+(1|schoolID)+depriv+depriv*gender,data=all.data.new)) # ns
```

### Look for specificity on the type of ACE
#### Note that the correlation between threat and deprivation here is only 0.386
```{r}
# cor.test(all.data.new$threat,all.data.new$depriv)
# summary(lmer(EF~age+gender+(1|state)+(1|schoolID)+threat+depriv,data=all.data.new)) # specific to depriv ***
# summary(lmer(WM~age+gender+(1|state)+(1|schoolID)+threat+depriv,data=all.data.new)) # specific to depriv ***
# summary(lmer(TP~age+gender+(1|state)+(1|schoolID)+threat+depriv,data=all.data.new)) # both threat * and depriv ***
```

## Create a correlation matrix of all the important variables
### Since the cognitive variables are more highly correlated with each other, we won't test specificity in a single model
```{r}
# important.variables <- all.data.new[,c("age","gender","threat","depriv","EF","WM","TP","IC")]
# important.variables$gender <- as.numeric(important.variables$gender)
# colnames(important.variables)<-c("Age","Gender","Threat","Depriv","Exec. Fxn","Working Mem","Temp. Proc.","Inhib. Cont.")
# corrplot(cor(important.variables,use="complete.obs"),method=c("number"), tl.col = "black", col=brewer.pal(n=8, name="Spectral"))
```



### Non-significant:
```{r}
# summary(lmer(ALERT~age+gender+(1|state)+(1|schoolID)+threat,data=all.data.new)) #ns
# summary(lmer(ORIENT~age+gender+(1|state)+(1|schoolID)+threat,data=all.data.new)) #ns
# summary(lmer(CONFLICT~age+gender+(1|state)+(1|schoolID)+threat,data=all.data.new)) #ns
# 
# summary(lmer(ALERT~age+gender+(1|state)+(1|schoolID)+depriv,data=all.data.new)) #ns
# summary(lmer(ORIENT~age+gender+(1|state)+(1|schoolID)+depriv,data=all.data.new)) #ns
# summary(lmer(CONFLICT~age+gender+(1|state)+(1|schoolID)+depriv,data=all.data.new)) #ns
# 
# summary(lmer(ALERT~age+gender+(1|state)+(1|schoolID)+threat+depriv+threat*gender+depriv*gender,data=all.data.new)) # 0.055
# 
# summary(lmer(IC~age+gender+(1|state)+(1|schoolID)+threat,data=all.data.new)) # ns
# summary(lmer(IC~age+gender+(1|state)+(1|schoolID)+depriv,data=all.data.new)) # ns
```


### Look for specificity on Physical vs Emotional Neglect (as an replication of ABCD findings)
```{r}
# Calculate emotional neglect variable by averaging across relevant items (the "depriv" one will represent physical neglect)
all.data.complete<-all.data.complete[all.data.complete$fat38a<50,]
all.data.complete$emo_neglect <- -rowMeans(data.frame(as.numeric(all.data.complete$fat38a)/3,as.numeric(all.data.complete$fat39a)/3),na.rm=TRUE) #,as.numeric(all.data.complete$fes18),as.numeric(all.data.complete$fes1),as.numeric(all.data.complete$fes42),as.numeric(all.data.complete$fes48))


# # Test specificity
# summary(lmer(EF~age+gender+(1|state)+(1|schoolID)+emo_neglect+depriv,data=all.data.complete)) # both sig
# summary(lmer(WM~age+gender+(1|state)+(1|schoolID)+emo_neglect+depriv,data=all.data.complete)) # both sig
# summary(lmer(TP~age+gender+(1|state)+(1|schoolID)+emo_neglect+depriv,data=all.data.complete)) # both sig 
# summary(lmer(IC~age+gender+(1|state)+(1|schoolID)+emo_neglect+depriv,data=all.data.complete)) # just depriv 
# 
# p.adjust(c(0.005610,1.72e-09,0.0030,3.22e-08,0.0111,5.23e-09,0.323230,0.014438),method="bonferroni") 


# try restricting age to ABCD range:
all.data.complete.ageres <- all.data.complete[all.data.complete$age<11.1,]
all.data.complete.ageres <- all.data.complete.ageres[all.data.complete.ageres$age>8.9,]
all.data.complete.ageres<-all.data.complete.ageres[all.data.complete.ageres$fat38a<50,]
all.data.complete.ageres$emo_neglect <- -rowMeans(data.frame(as.numeric(all.data.complete.ageres$fat38a)/3,as.numeric(all.data.complete.ageres$fat39a)/3),na.rm=TRUE) 

# Verify that correlation is low: it's 0.236
cor.test(all.data.complete.ageres$depriv,all.data.complete.ageres$emo_neglect)

# Test specificity
summary(lmer(EF~age+gender+(1|state)+(1|schoolID)+emo_neglect+depriv,data=all.data.complete.ageres)) # just depriv
summary(lmer(WM~age+gender+(1|state)+(1|schoolID)+emo_neglect+depriv,data=all.data.complete.ageres)) # just depriv
summary(lmer(TP~age+gender+(1|state)+(1|schoolID)+emo_neglect+depriv,data=all.data.complete.ageres)) # just depriv
summary(lmer(IC~age+gender+(1|state)+(1|schoolID)+emo_neglect+depriv,data=all.data.complete.ageres)) # neither 

p.adjust(c(0.0202,3.91e-05,0.0556,1.12e-06,0.020554,0.000262,0.4224,0.0588),method="bonferroni") 
```


# Get effect sizes
```{r}
library("effectsize")
model1<-anova(lmer(EF~age+gender+(1|state)+(1|schoolID)+emo_neglect+depriv,data=all.data.complete.ageres))
model2<-anova(lmer(WM~age+gender+(1|state)+(1|schoolID)+emo_neglect+depriv,data=all.data.complete.ageres))
model3<-anova(lmer(TP~age+gender+(1|state)+(1|schoolID)+emo_neglect+depriv,data=all.data.complete.ageres))
model4<-anova(lmer(IC~age+gender+(1|state)+(1|schoolID)+emo_neglect+depriv,data=all.data.complete.ageres))

eta2_emo_EF <- F_to_eta2(model1[3,]$`F value`,model1[3,]$NumDF,model1[3,]$DenDF)
eta2_phy_EF <- F_to_eta2(model1[4,]$`F value`,model1[4,]$NumDF,model1[4,]$DenDF)
eta2_emo_WM <- F_to_eta2(model2[3,]$`F value`,model2[3,]$NumDF,model2[3,]$DenDF)
eta2_phy_WM <- F_to_eta2(model2[4,]$`F value`,model2[4,]$NumDF,model2[4,]$DenDF)
eta2_emo_TP <- F_to_eta2(model3[3,]$`F value`,model3[3,]$NumDF,model3[3,]$DenDF)
eta2_phy_TP <- F_to_eta2(model3[4,]$`F value`,model3[4,]$NumDF,model3[4,]$DenDF)
eta2_emo_IC <- F_to_eta2(model4[3,]$`F value`,model4[3,]$NumDF,model4[3,]$DenDF)
eta2_phy_IC <- F_to_eta2(model4[4,]$`F value`,model4[4,]$NumDF,model4[4,]$DenDF)

eta2_emo_EF[1]
eta2_phy_EF[1]
eta2_emo_WM[1]
eta2_phy_WM[1]
eta2_emo_TP[1]
eta2_phy_TP[1]
eta2_emo_IC[1]
eta2_phy_IC[1]

```


## Create a correlation matrix of all the important variables
### Since the cognitive variables are more highly correlated with each other, we won't test specificity in a single model
```{r}
important.variables <- all.data.complete.ageres[,c("age","gender","emo_neglect","depriv","EF","WM","TP","IC")]
important.variables$gender <- as.numeric(important.variables$gender)
colnames(important.variables)<-c("Age","Gender","EmoNeglect","PhysNeglect","Exec. Fxn","Working Mem","Temp. Proc.","Inhib. Cont.")
corrplot(cor(important.variables,use="complete.obs"),method=c("number"), tl.col = "black", col=brewer.pal(n=8, name="Spectral"))
```

## Plots
```{r}
cols <- brewer.pal(10,"Paired")

 png("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/PhysEmoNeglect_ABCD_BHRC/Scatterplots/BHRC_PhysNeg_TP.png",
     width = 3000, 
     height = 3000,
     res = 850)
ggplot(all.data.complete.ageres, aes(x=depriv,y=TP)) +
  geom_point(colour=cols[2],size=1) +
  geom_smooth(method=lm,color="black") + xlab("Physical Neglect") + ylab("Temporal Processing") + theme(legend.position = "none") + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),panel.background = element_blank(), axis.line = element_line(colour = "black"))
dev.off()

 png("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/PhysEmoNeglect_ABCD_BHRC/Scatterplots/BHRC_PhysNeg_EF.png",
     width = 3000, 
     height = 3000,
     res = 850)
ggplot(all.data.complete.ageres, aes(x=depriv,y=EF)) +
  geom_point(colour=cols[4],size=1) +
  geom_smooth(method=lm,color="black") + xlab("Physical Neglect") + ylab("Exec. Fxn.") + theme(legend.position = "none") + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),panel.background = element_blank(), axis.line = element_line(colour = "black"))
dev.off()

 png("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/PhysEmoNeglect_ABCD_BHRC/Scatterplots/BHRC_PhysNeg_WM.png",
     width = 3000, 
     height = 3000,
     res = 850)
ggplot(all.data.complete.ageres, aes(x=depriv,y=WM)) +
  geom_point(colour=cols[8],size=1) +
  geom_smooth(method=lm,color="black") + xlab("Physical Neglect") + ylab("Working Memory") + theme(legend.position = "none") + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),panel.background = element_blank(), axis.line = element_line(colour = "black"))
dev.off()

 png("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/PhysEmoNeglect_ABCD_BHRC/Scatterplots/BHRC_PhysNeg_IC.png",
     width = 3000, 
     height = 3000,
     res = 850)
ggplot(all.data.complete.ageres, aes(x=depriv,y=IC)) +
  geom_point(colour=cols[10],size=1) +
  geom_smooth(method=lm,color="black") + xlab("Physical Neglect") + ylab("Inhibitory Control") + theme(legend.position = "none") + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),panel.background = element_blank(), axis.line = element_line(colour = "black"))
dev.off()

 png("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/PhysEmoNeglect_ABCD_BHRC/Scatterplots/BHRC_EmoNeg_TP.png",
     width = 3000, 
     height = 3000,
     res = 850)
ggplot(all.data.complete.ageres, aes(x=emo_neglect,y=TP)) +
  geom_point(position="jitter",colour=cols[2],size=1) +
  geom_smooth(method=lm,color="black") + xlab("Emotional Neglect") + ylab("Temporal Processing") + theme(legend.position = "none") + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),panel.background = element_blank(), axis.line = element_line(colour = "black"))
dev.off()

 png("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/PhysEmoNeglect_ABCD_BHRC/Scatterplots/BHRC_EmoNeg_EF.png",
     width = 3000, 
     height = 3000,
     res = 850)
ggplot(all.data.complete.ageres, aes(x=emo_neglect,y=EF)) +
  geom_point(position="jitter",colour=cols[4],size=1) +
  geom_smooth(method=lm,color="black") + xlab("Emotional Neglect") + ylab("Exec. Fxn.") + theme(legend.position = "none") + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),panel.background = element_blank(), axis.line = element_line(colour = "black"))
dev.off()

 png("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/PhysEmoNeglect_ABCD_BHRC/Scatterplots/BHRC_EmoNeg_WM.png",
     width = 3000, 
     height = 3000,
     res = 850)
ggplot(all.data.complete.ageres, aes(x=emo_neglect,y=WM)) +
  geom_point(position="jitter",colour=cols[8],size=1) +
  geom_smooth(method=lm,color="black") + xlab("Emotional Neglect") + ylab("Working Memory") + theme(legend.position = "none") + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),panel.background = element_blank(), axis.line = element_line(colour = "black"))
dev.off()

 png("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/PhysEmoNeglect_ABCD_BHRC/Scatterplots/BHRC_EmoNeg_IC.png",
     width = 3000, 
     height = 3000,
     res = 850)
ggplot(all.data.complete.ageres, aes(x=emo_neglect,y=IC)) +
  geom_point(position="jitter",colour=cols[10],size=1) +
  geom_smooth(method=lm,color="black") + xlab("Emotional Neglect") + ylab("Inhibitory Control") + theme(legend.position = "none") + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),panel.background = element_blank(), axis.line = element_line(colour = "black"))
dev.off()
```

# Demographics info
```{r}
# Gender (1, Male|2, Female)
sum(all.data.complete.ageres$gender==1,na.rm=TRUE)
round(sum(all.data.complete.ageres$gender==1,na.rm=TRUE)/dim(all.data.complete.ageres)[1],2)
sum(all.data.complete.ageres$gender==2,na.rm=TRUE)
round(sum(all.data.complete.ageres$gender==2,na.rm=TRUE)/dim(all.data.complete.ageres)[1],2)

# Skin Color (1, White | 2, Black | 3, Between white and black (brown) | 4, Indigenous | 5, Asian | 99, Does not know)
sum(all.data.complete.ageres$skincolor==1,na.rm=TRUE)
round(sum(all.data.complete.ageres$skincolor==1,na.rm=TRUE)/dim(all.data.complete.ageres)[1],2)
sum(all.data.complete.ageres$skincolor==2,na.rm=TRUE)
round(sum(all.data.complete.ageres$skincolor==2,na.rm=TRUE)/dim(all.data.complete.ageres)[1],2)
sum(all.data.complete.ageres$skincolor==3,na.rm=TRUE)
round(sum(all.data.complete.ageres$skincolor==3,na.rm=TRUE)/dim(all.data.complete.ageres)[1],2)
sum(all.data.complete.ageres$skincolor==4,na.rm=TRUE)
round(sum(all.data.complete.ageres$skincolor==4,na.rm=TRUE)/dim(all.data.complete.ageres)[1],2)
sum(all.data.complete.ageres$skincolor==5,na.rm=TRUE)
round(sum(all.data.complete.ageres$skincolor==5,na.rm=TRUE)/dim(all.data.complete.ageres)[1],2)

# How far did the head of the family study?
# 99, Does not know|1, Without study (illiterate)|2, Elementary school incomplete (did not finish the former 8th grade)|3, Elementary school completed (finished the former 8th grade)|4, Incomplete high school (did not finish the former high school)|5, High school (finished the former high school)|6, Incomplete higher education (did not finish college)|7, Higher education (finished college)|8, Higher education with postgraduate studies (master's / doctorate / specialization)

# NOTE: get ab6 variable for this ^ from the scale dom_s06_treat_w0w2
```





## ~~~~~~~~ ABCD ~~~~~~~~

### Load and organize data:
```{r}
nihtb<-read.table("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/NihTB/abcd_tbss01.txt",header=TRUE)
nihtb.baseline<-nihtb[nihtb$eventname=="baseline_year_1_arm_1",]
lmt<-read.table("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/Thomp/lmtp201.txt",header=TRUE)
lmt.baseline<-lmt[lmt$eventname=="baseline_year_1_arm_1",]
merged.data2 <- merge(nihtb.baseline,lmt.baseline[, c("subjectkey", setdiff(colnames(lmt.baseline),colnames(nihtb.baseline)))],by="subjectkey")
ravlt<-read.table("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/Thomp/abcd_ps01.txt",header=TRUE)
ravlt.baseline<-ravlt[ravlt$eventname=="baseline_year_1_arm_1",]
combined.data <- merge(merged.data2,ravlt.baseline[, c("subjectkey", setdiff(colnames(ravlt.baseline),colnames(merged.data2)))],by="subjectkey")
# trauma<-read.table("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/Strife/abcd_ptsd01.txt",header=TRUE)
# trauma.baseline<-trauma[trauma$eventname=="baseline_year_1_arm_1",]
# combined.data <- merge(merged.data3,trauma.baseline[, c("subjectkey", setdiff(colnames(trauma.baseline),colnames(merged.data3)))],by="subjectkey")
combined.data$nihtbx_flanker_uncorrected <- as.numeric(combined.data$nihtbx_flanker_uncorrected)
combined.data$nihtbx_picvocab_uncorrected <- as.numeric(combined.data$nihtbx_picvocab_uncorrected)
combined.data$nihtbx_list_uncorrected <- as.numeric(combined.data$nihtbx_list_uncorrected)
combined.data$nihtbx_pattern_uncorrected <- as.numeric(combined.data$nihtbx_pattern_uncorrected)
combined.data$nihtbx_cardsort_uncorrected <- as.numeric(combined.data$nihtbx_cardsort_uncorrected)
combined.data$nihtbx_picture_uncorrected <- as.numeric(combined.data$nihtbx_picture_uncorrected)
combined.data$nihtbx_reading_uncorrected <- as.numeric(combined.data$nihtbx_reading_uncorrected)
combined.data$lmt_scr_perc_correct <- as.numeric(combined.data$lmt_scr_perc_correct)
combined.data$pea_ravlt_sd_trial_i_tc <- as.numeric(combined.data$pea_ravlt_sd_trial_i_tc)
combined.data$pea_ravlt_sd_trial_ii_tc <- as.numeric(combined.data$pea_ravlt_sd_trial_ii_tc)
combined.data$pea_ravlt_sd_trial_iii_tc <- as.numeric(combined.data$pea_ravlt_sd_trial_iii_tc)
combined.data$pea_ravlt_sd_trial_iv_tc <- as.numeric(combined.data$pea_ravlt_sd_trial_iv_tc)
combined.data$pea_ravlt_sd_trial_v_tc <- as.numeric(combined.data$pea_ravlt_sd_trial_v_tc)
combined.data$interview_age <- as.numeric(combined.data$interview_age)

ind_pea_ravlt = c(which(names(combined.data)=="pea_ravlt_sd_trial_i_tc"),which(names(combined.data)=="pea_ravlt_sd_trial_ii_tc"),
	which(names(combined.data)=="pea_ravlt_sd_trial_iii_tc"),which(names(combined.data)=="pea_ravlt_sd_trial_iv_tc"),
	which(names(combined.data)=="pea_ravlt_sd_trial_v_tc")); names(combined.data)[ind_pea_ravlt]; summary(combined.data[,ind_pea_ravlt])
combined.data$pea_ravlt_ld = apply(combined.data[,ind_pea_ravlt],1,sum)

combined.data$pea_ravlt_ld <- as.numeric(combined.data$pea_ravlt_ld)

# Rename according to Thompson 2018 code
names(combined.data)[which(names(combined.data)=="nihtbx_picvocab_uncorrected")] = "PicVocab"
names(combined.data)[which(names(combined.data)=="nihtbx_flanker_uncorrected")] = "Flanker"
names(combined.data)[which(names(combined.data)=="nihtbx_list_uncorrected")] = "List"
names(combined.data)[which(names(combined.data)=="nihtbx_cardsort_uncorrected")] = "CardSort"
names(combined.data)[which(names(combined.data)=="nihtbx_pattern_uncorrected")] = "Pattern"
names(combined.data)[which(names(combined.data)=="nihtbx_picture_uncorrected")] = "Picture"
names(combined.data)[which(names(combined.data)=="nihtbx_reading_uncorrected")] = "Reading"
names(combined.data)[which(names(combined.data)=="pea_ravlt_ld")] = "RAVLT"
names(combined.data)[which(names(combined.data)=="lmt_scr_perc_correct")] = "LMT"


# Calculate Thompson factor scores and remove outliers
combined.data$thompson_PC1 <- (0.754*combined.data$PicVocab)+(0.213*combined.data$Flanker)+(0.471*combined.data$List)+(0.205*combined.data$CardSort)+(0.015*combined.data$Pattern)+(0.012*combined.data$Picture)+(0.82*combined.data$Reading)+(0.306*combined.data$RAVLT)+(0.5*combined.data$LMT)

combined.data$thompson_PC2 <- (0.065*combined.data$PicVocab)+(0.712*combined.data$Flanker)+(0.148*combined.data$List)+(0.71*combined.data$CardSort)+(0.813*combined.data$Pattern)+(0.135*combined.data$Picture)+(0.12*combined.data$Reading)+(0.125*combined.data$RAVLT)+(0.299*combined.data$LMT)

combined.data$thompson_PC3 <- (0.19*combined.data$PicVocab)+(0.067*combined.data$Flanker)+(0.493*combined.data$List)+(0.232*combined.data$CardSort)+(0.085*combined.data$Pattern)+(0.863*combined.data$Picture)+(0.122*combined.data$Reading)+(0.712*combined.data$RAVLT)+(0.068*combined.data$LMT)

mean_PC1 <- mean(combined.data$thompson_PC1,na.rm=TRUE)
mean_PC2 <- mean(combined.data$thompson_PC2,na.rm=TRUE)
mean_PC3 <- mean(combined.data$thompson_PC3,na.rm=TRUE)
sd3_PC1 <- sd(combined.data$thompson_PC1,na.rm=TRUE)*3
sd3_PC2 <- sd(combined.data$thompson_PC2,na.rm=TRUE)*3
sd3_PC3 <- sd(combined.data$thompson_PC3,na.rm=TRUE)*3
sum(combined.data$thompson_PC1 > mean_PC1+sd3_PC1,na.rm=TRUE) # 10 outliers
sum(combined.data$thompson_PC2 > mean_PC2+sd3_PC2,na.rm=TRUE) # 3 outliers
sum(combined.data$thompson_PC3 > mean_PC3+sd3_PC3,na.rm=TRUE) # 2 outliers

combined.data.noOutliers <- combined.data[(combined.data$thompson_PC1>(mean_PC1-sd3_PC1) & combined.data$thompson_PC1<(mean_PC1+sd3_PC1) & combined.data$thompson_PC2>(mean_PC2-sd3_PC2) & combined.data$thompson_PC2<(mean_PC2+sd3_PC2) & combined.data$thompson_PC3>(mean_PC3-sd3_PC3) & combined.data$thompson_PC3<(mean_PC3+sd3_PC3)),]


# # Calculate types of ACEs
# combined.data.noOutliers[,224:240]<-as.numeric(unlist(combined.data.noOutliers[,224:240]))
# 
# # Calculation of subscore with items related to physical and sexual abuse
# combined.data.noOutliers$abuse <- rowSums(data.frame(as.numeric(combined.data.noOutliers$ksads_ptsd_raw_761_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_762_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_763_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_767_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_768_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_769_p)),na.rm=TRUE)
# 
# # Calculation of subscore with items related to trauma (car accidents, natural disasters, loss, etc.)
# combined.data.noOutliers$trauma <- rowSums(data.frame(as.numeric(combined.data.noOutliers$ksads_ptsd_raw_754_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_755_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_756_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_757_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_758_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_759_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_760_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_766_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_770_p)),na.rm=TRUE)
# 
# # Calculation of total score from the KSADS items
# combined.data.noOutliers$totalACEs <- rowSums(data.frame(as.numeric(combined.data.noOutliers$ksads_ptsd_raw_754_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_755_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_756_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_757_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_758_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_759_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_760_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_761_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_762_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_763_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_764_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_765_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_766_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_767_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_768_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_769_p),as.numeric(combined.data.noOutliers$ksads_ptsd_raw_770_p)),na.rm=TRUE)

# Remember to add in this variable about family structure so we can use it as a covariate
family <-read.table("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/ses/acspsw03.txt",header=TRUE)
family.baseline<-family[family$eventname=="baseline_year_1_arm_1",]
abcd.data.almost <- merge(combined.data.noOutliers,family.baseline[, c("subjectkey", setdiff(colnames(family.baseline),colnames(combined.data.noOutliers)))],by="subjectkey")

# also add in the variable for site ID to use as a covariate
site_info <- readRDS("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/DEAP-siteID.rds")
site.baseline<-site_info[site_info$event_name=="baseline_year_1_arm_1",]
colnames(site.baseline)[1]<-"subjectkey"
abcd.data.withFamAndSite <- merge(abcd.data.almost,site.baseline[,c("subjectkey", setdiff(colnames(site.baseline),colnames(abcd.data.almost)))],by="subjectkey")

emo.neglect <-read.table("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/neglect/crpbi01.txt",header=TRUE)
emo.neglect.baseline<-emo.neglect[emo.neglect$eventname=="baseline_year_1_arm_1",]
phy.neglect <-read.table("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/neglect/pmq01.txt",header=TRUE)
phy.neglect.baseline<-phy.neglect[phy.neglect$eventname=="baseline_year_1_arm_1",]
neglect.data <- merge(emo.neglect.baseline,phy.neglect.baseline[, c("subjectkey", setdiff(colnames(phy.neglect.baseline),colnames(emo.neglect.baseline)))],by="subjectkey")

abcd.data<-merge(abcd.data.withFamAndSite,neglect.data[,c("subjectkey", setdiff(colnames(neglect.data),colnames(abcd.data.withFamAndSite)))],by="subjectkey")

# Calculate subscales of deprivation (emotional and physical neglect) - see this ref for motivation https://www.sciencedirect.com/science/article/pii/S2352289518300821
abcd.data$acceptance <- rowMeans(data.frame(as.numeric(abcd.data$crpbi_parent1_y),as.numeric(abcd.data$crpbi_parent2_y),as.numeric(abcd.data$crpbi_parent3_y),as.numeric(abcd.data$crpbi_parent4_y),as.numeric(abcd.data$crpbi_parent5_y)))

abcd.data$monitoring <- rowMeans(data.frame(as.numeric(abcd.data$parent_monitor_q1_y),as.numeric(abcd.data$parent_monitor_q2_y),as.numeric(abcd.data$parent_monitor_q3_y),as.numeric(abcd.data$parent_monitor_q4_y),as.numeric(abcd.data$parent_monitor_q5_y)))



# # Binarize the four ACEs subtypes (2 "Threat" types: Abuse and Trauma; 2 "Deprivation" types: Emotional Neglect and Physical Neglect)
# abcd.data$abuse.binary <- factor(abcd.data$abuse>=1,labels = c("No Abuse","Abuse"))
# abcd.data$abuse.binary.numeric <- as.numeric(abcd.data$abuse.binary)
# abcd.data$trauma.binary <- factor(abcd.data$trauma>=1,labels = c("No Trauma","Trauma"))
# abcd.data$trauma.binary.numeric <- as.numeric(abcd.data$trauma.binary)
# 
# median.monitoring = median(na.omit(abcd.data$monitoring))
# median.acceptance = median(na.omit(abcd.data$acceptance))
# abcd.data$monitoring.binary <- factor(abcd.data$monitoring<20,labels = c("Low Physical Neglect","High Physical Neglect"))
# abcd.data$monitoring.binary.numeric <- as.numeric(abcd.data$monitoring.binary)
# abcd.data$acceptance.binary <- factor(abcd.data$acceptance<7.5,labels = c("Low Emotional Neglect","High Emotional Neglect"))
# abcd.data$acceptance.binary.numeric <- as.numeric(abcd.data$acceptance.binary)
```


## Plot everything
```{r}
# 
# data.long <- gather(abcd.data, CogType, CogScore, thompson_PC1,thompson_PC2,thompson_PC3, factor_key=TRUE)
# 
# names(data.long)[names(data.long) == 'acceptance.binary.numeric'] <- 'depriv.emo'
# names(data.long)[names(data.long) == 'monitoring.binary.numeric'] <- 'depriv.phys'
# names(data.long)[names(data.long) == 'trauma.binary.numeric'] <- 'threat.trauma'
# names(data.long)[names(data.long) == 'abuse.binary.numeric'] <- 'threat.abuse'
# 
# abcd.long <- gather(data.long, ACEsType, ACEsScore, depriv.emo,depriv.phys,threat.abuse,threat.trauma, factor_key=TRUE)
# abcd.long.complete <- abcd.long[complete.cases(abcd.long[,c("CogType","CogScore","ACEsType","ACEsScore")]),c("CogType","CogScore","ACEsType","ACEsScore","interview_age","sex","rel_family_id")]
# 
# ggplot(data=abcd.long.complete, aes(x=ACEsScore,y=CogScore,fill=interaction(ACEsType,CogType))) +
#   geom_bar(stat="identity",position="dodge") + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
# panel.background = element_blank(), axis.line = element_line(colour = "black")) +xlab("ACEs") + ylab("Cognition") +coord_cartesian(ylim=c(250,325)) + facet_grid(abcd.long.complete$ACEsType~abcd.long.complete$CogType) + theme(legend.position = "none")


```

## Create a correlation matrix of all the important variables
```{r}
important.variables2 <- abcd.data[,c("interview_age","sex","acceptance","monitoring","thompson_PC1","thompson_PC2","thompson_PC3")]
important.variables2$sex <- as.numeric(as.factor(important.variables2$sex))
colnames(important.variables2)<-c("Age","Sex","EmoNeglect","PhysNeglect","Gen. Cog.","EF","Learning/Mem")
corrplot(cor(important.variables2,use="complete.obs"),method=c("number"), tl.col = "black", col=brewer.pal(n=8, name="Spectral"))
```


## Run linear mixed effects models!
```{r}
summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+acceptance+monitoring,data=abcd.data))
summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+acceptance+monitoring,data=abcd.data))
summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+acceptance+monitoring,data=abcd.data))

# summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+acceptance.binary+monitoring.binary+abuse.binary+trauma.binary,data=abcd.data))
# p.adjust(c(0.615, 2e-16,0.035,6.96e-11),method="bonferroni")
# # PC1 is related to physical neglect *** and trauma ***
# 
# summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+acceptance.binary+monitoring.binary+abuse.binary+trauma.binary,data=abcd.data))
# p.adjust(c(0.389, 7.47e-15,0.0096,4.39e-7),method="bonferroni")
# # PC1 is related to physical neglect ***, abuse *, and trauma ***
# 
# summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+acceptance.binary+monitoring.binary+abuse.binary+trauma.binary,data=abcd.data))
# p.adjust(c(0.034, 2e-16,0.014,6.18e-8),method="bonferroni")
# # PC3 is related to physical neglect *** and trauma ***


## Separate models for physical and emotional neglect:
summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+monitoring,data=abcd.data)) # ***
summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+monitoring,data=abcd.data)) # ***
summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+monitoring,data=abcd.data)) # ***
summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+acceptance,data=abcd.data)) # **
summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+acceptance,data=abcd.data)) # .
summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+acceptance,data=abcd.data)) # **
```

# Get effect sizes
```{r}
library("effectsize")
model1<-anova(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+acceptance+monitoring,data=abcd.data))
model2<-anova(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+acceptance+monitoring,data=abcd.data))
model3<-anova(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+acceptance+monitoring,data=abcd.data))

eta2_emo_PC1 <- F_to_eta2(model1[3,]$`F value`,model1[3,]$NumDF,model1[3,]$DenDF)
eta2_phy_PC1 <- F_to_eta2(model1[4,]$`F value`,model1[4,]$NumDF,model1[4,]$DenDF)
eta2_emo_PC2 <- F_to_eta2(model2[3,]$`F value`,model2[3,]$NumDF,model2[3,]$DenDF)
eta2_phy_PC2 <- F_to_eta2(model2[4,]$`F value`,model2[4,]$NumDF,model2[4,]$DenDF)
eta2_emo_PC3 <- F_to_eta2(model3[3,]$`F value`,model3[3,]$NumDF,model3[3,]$DenDF)
eta2_phy_PC3 <- F_to_eta2(model3[4,]$`F value`,model3[4,]$NumDF,model3[4,]$DenDF)

eta2_emo_PC1[1]
eta2_phy_PC1[1]
eta2_emo_PC2[1]
eta2_phy_PC2[1]
eta2_emo_PC3[1]
eta2_phy_PC3[1]


# effect sizes for separate models of physical and emotional neglect:
model1<-anova(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+monitoring,data=abcd.data))
model2<-anova(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+monitoring,data=abcd.data))
model3<-anova(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+monitoring,data=abcd.data))
model4<-anova(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+acceptance,data=abcd.data))
model5<-anova(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+acceptance,data=abcd.data))
model6<-anova(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+acceptance,data=abcd.data))

eta2_emo_PC1 <- F_to_eta2(model4[3,]$`F value`,model1[3,]$NumDF,model1[3,]$DenDF)
eta2_phy_PC1 <- F_to_eta2(model1[3,]$`F value`,model1[3,]$NumDF,model1[3,]$DenDF)
eta2_emo_PC2 <- F_to_eta2(model5[3,]$`F value`,model2[3,]$NumDF,model2[3,]$DenDF)
eta2_phy_PC2 <- F_to_eta2(model2[3,]$`F value`,model2[3,]$NumDF,model2[3,]$DenDF)
eta2_emo_PC3 <- F_to_eta2(model6[3,]$`F value`,model3[3,]$NumDF,model3[3,]$DenDF)
eta2_phy_PC3 <- F_to_eta2(model3[3,]$`F value`,model3[3,]$NumDF,model3[3,]$DenDF)

eta2_emo_PC1[1]
eta2_phy_PC1[1]
eta2_emo_PC2[1]
eta2_phy_PC2[1]
eta2_emo_PC3[1]
eta2_phy_PC3[1]



```

### Look at specific items within parental warmth and parental monitoring:
```{r}
abcd.data$crpbi_parent1_y<-as.numeric(abcd.data$crpbi_parent1_y)
abcd.data$crpbi_parent2_y<-as.numeric(abcd.data$crpbi_parent2_y)
abcd.data$crpbi_parent3_y<-as.numeric(abcd.data$crpbi_parent3_y)
abcd.data$crpbi_parent4_y<-as.numeric(abcd.data$crpbi_parent4_y)
abcd.data$crpbi_parent5_y<-as.numeric(abcd.data$crpbi_parent5_y)
abcd.data$parent_monitor_q1_y<-as.numeric(abcd.data$parent_monitor_q1_y)
abcd.data$parent_monitor_q2_y<-as.numeric(abcd.data$parent_monitor_q2_y)
abcd.data$parent_monitor_q3_y<-as.numeric(abcd.data$parent_monitor_q3_y)
abcd.data$parent_monitor_q4_y<-as.numeric(abcd.data$parent_monitor_q4_y)
abcd.data$parent_monitor_q5_y<-as.numeric(abcd.data$parent_monitor_q5_y)


important.variables3 <- abcd.data[,c("crpbi_parent1_y","crpbi_parent2_y","crpbi_parent3_y","crpbi_parent4_y","crpbi_parent5_y")]
colnames(important.variables3)<-c("Feel better talking worries","Smiles at me","Feel better when upset","Shows love","Easy to talk to")
corrplot(cor(important.variables3,use="complete.obs"),method=c("number"), tl.col = "black", col=brewer.pal(n=8, name="Spectral"))

important.variables4 <- abcd.data[,c("parent_monitor_q1_y","parent_monitor_q2_y","parent_monitor_q3_y","parent_monitor_q4_y","parent_monitor_q5_y")]
colnames(important.variables4)<-c("Know where you are","Know who you're with","Know how to contact","Talk over plans","Dinner together")
corrplot(cor(important.variables4,use="complete.obs"),method=c("number"), tl.col = "black", col=brewer.pal(n=8, name="Spectral"))

summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+parent_monitor_q1_y+parent_monitor_q2_y+parent_monitor_q3_y+parent_monitor_q4_y+parent_monitor_q5_y,data=abcd.data)) # all significant *** (Q4 opp direction)
summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+parent_monitor_q1_y+parent_monitor_q2_y+parent_monitor_q3_y+parent_monitor_q4_y+parent_monitor_q5_y,data=abcd.data)) # all but Q3 sig (Q4 opp direction)
summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+parent_monitor_q1_y+parent_monitor_q2_y+parent_monitor_q3_y+parent_monitor_q4_y+parent_monitor_q5_y,data=abcd.data)) # all significant (Q4 opp direction)
summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+crpbi_parent1_y+crpbi_parent2_y+crpbi_parent3_y+crpbi_parent4_y+crpbi_parent5_y,data=abcd.data)) # Q2, Q4, Q5 significant (Q5 opp direction)
summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+crpbi_parent1_y+crpbi_parent2_y+crpbi_parent3_y+crpbi_parent4_y+crpbi_parent5_y,data=abcd.data)) # Q2, Q4, Q5 significant (Q5 opp direction)
summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+crpbi_parent1_y+crpbi_parent2_y+crpbi_parent3_y+crpbi_parent4_y+crpbi_parent5_y,data=abcd.data)) # Q2, Q4, Q5 significant (Q5 opp direction)

```


# look for mediation: SES --> caregiving --> cognition
```{r}
summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+monitoring,data=abcd.data))
summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+household.income,data=abcd.data))
summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+household.income+monitoring,data=abcd.data))
# partial mediation!

summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+monitoring,data=abcd.data))
summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+household.income,data=abcd.data))
summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+household.income+monitoring,data=abcd.data))
# partial mediation!

summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+monitoring,data=abcd.data))
summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+household.income,data=abcd.data))
summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+household.income+monitoring,data=abcd.data))
# partial mediation!



# Simplify household income variable:
abcd.data$household.income.simple <- ifelse(abcd.data$household.income=="[>=100K]",1,0)

summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+monitoring,data=abcd.data))
summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+household.income.simple,data=abcd.data))
summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+household.income.simple+monitoring,data=abcd.data))
# partial mediation!

summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+monitoring,data=abcd.data))
summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+household.income.simple,data=abcd.data))
summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+household.income.simple+monitoring,data=abcd.data))
# partial mediation!

summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+monitoring,data=abcd.data))
summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+household.income.simple,data=abcd.data))
summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+household.income.simple+monitoring,data=abcd.data))
# partial mediation!



# Test for significance of mediation models with bootstrapping
bs_indir = c()
for (i in 1:10){
  thisSample <- sample(c(1:dim(abcd.data)[1]),dim(abcd.data)[1],replace=TRUE)
  pathc<-summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+household.income.simple,data=abcd.data[thisSample,]))
  pathcp<-summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+household.income.simple+monitoring,data=abcd.data[thisSample,]))
  indir<-pathc$coefficients[4]-pathcp$coefficients[5]
  bs_indir <- c(bs_indir,indir)
}
t.test(bs_indir,conf.level=0.95)
## Significant partial mediation

bs_indir = c()
for (i in 1:10){
  thisSample <- sample(c(1:dim(abcd.data)[1]),dim(abcd.data)[1],replace=TRUE)
  pathc<-summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+household.income.simple,data=abcd.data[thisSample,]))
  pathcp<-summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+household.income.simple+monitoring,data=abcd.data[thisSample,]))
  indir<-pathc$coefficients[4]-pathcp$coefficients[5]
  bs_indir <- c(bs_indir,indir)
}
t.test(bs_indir,conf.level=0.95)
## Significant partial mediation

bs_indir = c()
for (i in 1:10){
  thisSample <- sample(c(1:dim(abcd.data)[1]),dim(abcd.data)[1],replace=TRUE)
  pathc<-summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+household.income.simple,data=abcd.data[thisSample,]))
  pathcp<-summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+household.income.simple+monitoring,data=abcd.data[thisSample,]))
  indir<-pathc$coefficients[4]-pathcp$coefficients[5]
  bs_indir <- c(bs_indir,indir)
}
t.test(bs_indir,conf.level=0.95)
## Significant partial mediation
```



### no significant interactions with sex
```{r}
# summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+monitoring.binary+monitoring.binary*sex,data=abcd.data))
# summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+monitoring.binary+monitoring.binary*sex,data=abcd.data))
# summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+monitoring.binary+monitoring.binary*sex,data=abcd.data))
# 
# summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+abuse.binary+abuse.binary*sex,data=abcd.data))
# summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+abuse.binary+abuse.binary*sex,data=abcd.data))
# summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+abuse.binary+abuse.binary*sex,data=abcd.data))
# 
# summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+trauma.binary+trauma.binary*sex,data=abcd.data))
# summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+trauma.binary+trauma.binary*sex,data=abcd.data))
# summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+trauma.binary+trauma.binary*sex,data=abcd.data))
# 
# summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+acceptance.binary+acceptance.binary*sex,data=abcd.data))
# summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+acceptance.binary+acceptance.binary*sex,data=abcd.data))
# summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+acceptance.binary+acceptance.binary*sex,data=abcd.data))
```


### models split out by ACE type
```{r}
# summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+acceptance.binary,data=abcd.data))
# summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+monitoring.binary,data=abcd.data)) # ***
# summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+abuse.binary,data=abcd.data)) # ***
# summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+trauma.binary,data=abcd.data)) # ***
# 
# summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+acceptance.binary,data=abcd.data))
# summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+monitoring.binary,data=abcd.data)) # ***
# summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+abuse.binary,data=abcd.data)) # **
# summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+trauma.binary,data=abcd.data)) # ***
# 
# summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+acceptance.binary,data=abcd.data)) # **
# summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+monitoring.binary,data=abcd.data)) # ***
# summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+abuse.binary,data=abcd.data)) # **
# summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+trauma.binary,data=abcd.data)) # ***
```


## Plots
```{r}
cols <- brewer.pal(10,"Paired")

 png("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/PhysEmoNeglect_ABCD_BHRC/Scatterplots/ABCD_PhysNeg_PC1.png",
     width = 3000, 
     height = 3000,
     res = 850)
ggplot(abcd.data, aes(x=-monitoring,y=thompson_PC1)) +
  geom_point(position="jitter",colour=cols[2],size=1) +
  geom_smooth(method=lm,color="black") + xlab("Physical Neglect") + ylab("PC1: General Cognition") + theme(legend.position = "none") + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),panel.background = element_blank(), axis.line = element_line(colour = "black"))
dev.off()

 png("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/PhysEmoNeglect_ABCD_BHRC/Scatterplots/ABCD_PhysNeg_PC2.png",
     width = 3000, 
     height = 3000,
     res = 850)
ggplot(abcd.data, aes(x=-monitoring,y=thompson_PC2)) +
  geom_point(position="jitter",colour=cols[4],size=1) +
  geom_smooth(method=lm,color="black") + xlab("Physical Neglect") + ylab("PC2: Exec. Fxn.") + theme(legend.position = "none") + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),panel.background = element_blank(), axis.line = element_line(colour = "black"))
dev.off()

 png("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/PhysEmoNeglect_ABCD_BHRC/Scatterplots/ABCD_PhysNeg_PC3.png",
     width = 3000, 
     height = 3000,
     res = 850)
ggplot(abcd.data, aes(x=-monitoring,y=thompson_PC3)) +
  geom_point(position="jitter",colour=cols[8],size=1) +
  geom_smooth(method=lm,color="black") + xlab("Physical Neglect") + ylab("PC3: Learning/Memory") + theme(legend.position = "none") + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),panel.background = element_blank(), axis.line = element_line(colour = "black"))
dev.off()

 png("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/PhysEmoNeglect_ABCD_BHRC/Scatterplots/ABCD_EmoNeg_PC1.png",
     width = 3000, 
     height = 3000,
     res = 850)
ggplot(abcd.data, aes(x=-acceptance,y=thompson_PC1)) +
  geom_point(position="jitter",colour=cols[2],size=1) +
  geom_smooth(method=lm,color="black") + xlab("Emotional Neglect") + ylab("PC1: General Cognition") + theme(legend.position = "none") + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),panel.background = element_blank(), axis.line = element_line(colour = "black"))
dev.off()

 png("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/PhysEmoNeglect_ABCD_BHRC/Scatterplots/ABCD_EmoNeg_PC2.png",
     width = 3000, 
     height = 3000,
     res = 850)
ggplot(abcd.data, aes(x=-acceptance,y=thompson_PC2)) +
  geom_point(position="jitter",colour=cols[4],size=1) +
  geom_smooth(method=lm,color="black") + xlab("Emotional Neglect") + ylab("PC2: Exec. Fxn.") + theme(legend.position = "none") + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),panel.background = element_blank(), axis.line = element_line(colour = "black"))
dev.off()

 png("/Users/ariellekeller/Documents/Kellernet_PrelimAnalysis/PhysEmoNeglect_ABCD_BHRC/Scatterplots/ABCD_EmoNeg_PC3.png",
     width = 3000, 
     height = 3000,
     res = 850)
ggplot(abcd.data, aes(x=-acceptance,y=thompson_PC3)) +
  geom_point(position="jitter",colour=cols[8],size=1) +
  geom_smooth(method=lm,color="black") + xlab("Emotional Neglect") + ylab("PC3: Learning/Memory") + theme(legend.position = "none") + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),panel.background = element_blank(), axis.line = element_line(colour = "black"))
dev.off()
```

# Sandbox to test some covariates in ABCD
```{r}

# Race/Ethnicity (1 = White; 2 = Black; 3 = Hispanic; 4 = Asian; 5 = Other)
summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+race_ethnicity+acceptance+monitoring,data=abcd.data))
summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+race_ethnicity+acceptance+monitoring,data=abcd.data))
summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+race_ethnicity+acceptance+monitoring,data=abcd.data))

# Race 6 level (1: White | 2: Black | 3: Asian | 4: AIAN/NHPI | 5: Other | 6: Mixed)
summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+race.6level+acceptance+monitoring,data=abcd.data))
summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+race.6level+acceptance+monitoring,data=abcd.data))
summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+race.6level+acceptance+monitoring,data=abcd.data))

# Language/Reading ability
summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+as.numeric(nihtbx_reading_agecorrected)+acceptance+monitoring,data=abcd.data))
summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+as.numeric(nihtbx_reading_agecorrected)+race_ethnicity+acceptance+monitoring,data=abcd.data))
summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+as.numeric(nihtbx_reading_agecorrected)+race_ethnicity+acceptance+monitoring,data=abcd.data))

# Parent's highest degree of education
summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+high.educ+acceptance+monitoring,data=abcd.data))
summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+high.educ+acceptance+monitoring,data=abcd.data))
summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+high.educ+acceptance+monitoring,data=abcd.data))

# Household income
summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+household.income+acceptance+monitoring,data=abcd.data))
summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+household.income+acceptance+monitoring,data=abcd.data))
summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+household.income+acceptance+monitoring,data=abcd.data))



```

# Get demographics info
```{r}
abcd.data.noNA2 <- abcd.data[!is.na(abcd.data$acceptance),]
abcd.data.noNA <- abcd.data.noNA2[!is.na(abcd.data.noNA2$monitoring),]

sum(abcd.data.noNA$household.income=="[<50K]",na.rm=TRUE)
mean(abcd.data.noNA[abcd.data.noNA$household.income=="[<50K]",]$acceptance,na.rm=TRUE)
sd(abcd.data.noNA[abcd.data.noNA$household.income=="[<50K]",]$acceptance,na.rm=TRUE)
mean(abcd.data.noNA[abcd.data.noNA$household.income=="[<50K]",]$monitoring,na.rm=TRUE)
sd(abcd.data.noNA[abcd.data.noNA$household.income=="[<50K]",]$monitoring,na.rm=TRUE)

sum(abcd.data.noNA$household.income=="[>=50K & <100K]",na.rm=TRUE)
mean(abcd.data.noNA[abcd.data.noNA$household.income=="[>=50K & <100K]",]$acceptance,na.rm=TRUE)
sd(abcd.data.noNA[abcd.data.noNA$household.income=="[>=50K & <100K]",]$acceptance,na.rm=TRUE)
mean(abcd.data.noNA[abcd.data.noNA$household.income=="[>=50K & <100K]",]$monitoring,na.rm=TRUE)
sd(abcd.data.noNA[abcd.data.noNA$household.income=="[>=50K & <100K]",]$monitoring,na.rm=TRUE)

sum(abcd.data.noNA$household.income=="[>=100K]",na.rm=TRUE)
mean(abcd.data.noNA[abcd.data.noNA$household.income=="[>=100K]",]$acceptance,na.rm=TRUE)
sd(abcd.data.noNA[abcd.data.noNA$household.income=="[>=100K]",]$acceptance,na.rm=TRUE)
mean(abcd.data.noNA[abcd.data.noNA$household.income=="[>=100K]",]$monitoring,na.rm=TRUE)
sd(abcd.data.noNA[abcd.data.noNA$household.income=="[>=100K]",]$monitoring,na.rm=TRUE)

summary(aov(acceptance~household.income,data=abcd.data.noNA)) # ***

sum(abcd.data.noNA$high.educ=="< HS Diploma",na.rm=TRUE)
mean(abcd.data.noNA[abcd.data.noNA$high.educ=="< HS Diploma",]$acceptance,na.rm=TRUE)
sd(abcd.data.noNA[abcd.data.noNA$high.educ=="< HS Diploma",]$acceptance,na.rm=TRUE)
mean(abcd.data.noNA[abcd.data.noNA$high.educ=="< HS Diploma",]$monitoring,na.rm=TRUE)
sd(abcd.data.noNA[abcd.data.noNA$high.educ=="< HS Diploma",]$monitoring,na.rm=TRUE)

sum(abcd.data.noNA$high.educ=="HS Diploma/GED",na.rm=TRUE)
mean(abcd.data.noNA[abcd.data.noNA$high.educ=="HS Diploma/GED",]$acceptance,na.rm=TRUE)
sd(abcd.data.noNA[abcd.data.noNA$high.educ=="HS Diploma/GED",]$acceptance,na.rm=TRUE)
mean(abcd.data.noNA[abcd.data.noNA$high.educ=="HS Diploma/GED",]$monitoring,na.rm=TRUE)
sd(abcd.data.noNA[abcd.data.noNA$high.educ=="HS Diploma/GED",]$monitoring,na.rm=TRUE)

sum(abcd.data.noNA$high.educ=="Some College",na.rm=TRUE)
mean(abcd.data.noNA[abcd.data.noNA$high.educ=="Some College",]$acceptance,na.rm=TRUE)
sd(abcd.data.noNA[abcd.data.noNA$high.educ=="Some College",]$acceptance,na.rm=TRUE)
mean(abcd.data.noNA[abcd.data.noNA$high.educ=="Some College",]$monitoring,na.rm=TRUE)
sd(abcd.data.noNA[abcd.data.noNA$high.educ=="Some College",]$monitoring,na.rm=TRUE)

sum(abcd.data.noNA$high.educ=="Bachelor",na.rm=TRUE)
mean(abcd.data.noNA[abcd.data.noNA$high.educ=="Bachelor",]$acceptance,na.rm=TRUE)
sd(abcd.data.noNA[abcd.data.noNA$high.educ=="Bachelor",]$acceptance,na.rm=TRUE)
mean(abcd.data.noNA[abcd.data.noNA$high.educ=="Bachelor",]$monitoring,na.rm=TRUE)
sd(abcd.data.noNA[abcd.data.noNA$high.educ=="Bachelor",]$monitoring,na.rm=TRUE)

sum(abcd.data.noNA$high.educ=="Post Graduate Degree",na.rm=TRUE)
mean(abcd.data.noNA[abcd.data.noNA$high.educ=="Post Graduate Degree",]$acceptance,na.rm=TRUE)
sd(abcd.data.noNA[abcd.data.noNA$high.educ=="Post Graduate Degree",]$acceptance,na.rm=TRUE)
mean(abcd.data.noNA[abcd.data.noNA$high.educ=="Post Graduate Degree",]$monitoring,na.rm=TRUE)
sd(abcd.data.noNA[abcd.data.noNA$high.educ=="Post Graduate Degree",]$monitoring,na.rm=TRUE)

summary(aov(acceptance~high.educ,data=abcd.data.noNA)) # ***

#(1 = White; 2 = Black; 3 = Hispanic; 4 = Asian; 5 = Other)
sum(abcd.data.noNA$race_ethnicity=="1",na.rm=TRUE)
round(mean(abcd.data.noNA[abcd.data.noNA$race_ethnicity=="1",]$acceptance,na.rm=TRUE),2)
round(sd(abcd.data.noNA[abcd.data.noNA$race_ethnicity=="1",]$acceptance,na.rm=TRUE),2)
round(mean(abcd.data.noNA[abcd.data.noNA$race_ethnicity=="1",]$monitoring,na.rm=TRUE),2)
round(sd(abcd.data.noNA[abcd.data.noNA$race_ethnicity=="1",]$monitoring,na.rm=TRUE),2)

sum(abcd.data.noNA$race_ethnicity=="2",na.rm=TRUE)
round(mean(abcd.data.noNA[abcd.data.noNA$race_ethnicity=="2",]$acceptance,na.rm=TRUE),2)
round(sd(abcd.data.noNA[abcd.data.noNA$race_ethnicity=="2",]$acceptance,na.rm=TRUE),2)
round(mean(abcd.data.noNA[abcd.data.noNA$race_ethnicity=="2",]$monitoring,na.rm=TRUE),2)
round(sd(abcd.data.noNA[abcd.data.noNA$race_ethnicity=="2",]$monitoring,na.rm=TRUE),2)

sum(abcd.data.noNA$race_ethnicity=="3",na.rm=TRUE)
round(mean(abcd.data.noNA[abcd.data.noNA$race_ethnicity=="3",]$acceptance,na.rm=TRUE),2)
round(sd(abcd.data.noNA[abcd.data.noNA$race_ethnicity=="3",]$acceptance,na.rm=TRUE),2)
round(mean(abcd.data.noNA[abcd.data.noNA$race_ethnicity=="3",]$monitoring,na.rm=TRUE),2)
round(sd(abcd.data.noNA[abcd.data.noNA$race_ethnicity=="3",]$monitoring,na.rm=TRUE),2)

sum(abcd.data.noNA$race_ethnicity=="4",na.rm=TRUE)
round(mean(abcd.data.noNA[abcd.data.noNA$race_ethnicity=="4",]$acceptance,na.rm=TRUE),2)
round(sd(abcd.data.noNA[abcd.data.noNA$race_ethnicity=="4",]$acceptance,na.rm=TRUE),2)
round(mean(abcd.data.noNA[abcd.data.noNA$race_ethnicity=="4",]$monitoring,na.rm=TRUE),2)
round(sd(abcd.data.noNA[abcd.data.noNA$race_ethnicity=="4",]$monitoring,na.rm=TRUE),2)

sum(abcd.data.noNA$race_ethnicity=="5",na.rm=TRUE)
round(mean(abcd.data.noNA[abcd.data.noNA$race_ethnicity=="5",]$acceptance,na.rm=TRUE),2)
round(sd(abcd.data.noNA[abcd.data.noNA$race_ethnicity=="5",]$acceptance,na.rm=TRUE),2)
round(mean(abcd.data.noNA[abcd.data.noNA$race_ethnicity=="5",]$monitoring,na.rm=TRUE),2)
round(sd(abcd.data.noNA[abcd.data.noNA$race_ethnicity=="5",]$monitoring,na.rm=TRUE),2)


sum(abcd.data.noNA$sex=="F",na.rm=TRUE)
round(mean(abcd.data.noNA[abcd.data.noNA$sex=="F",]$acceptance,na.rm=TRUE),2)
round(sd(abcd.data.noNA[abcd.data.noNA$sex=="F",]$acceptance,na.rm=TRUE),2)
round(mean(abcd.data.noNA[abcd.data.noNA$sex=="F",]$monitoring,na.rm=TRUE),2)
round(sd(abcd.data.noNA[abcd.data.noNA$sex=="F",]$monitoring,na.rm=TRUE),2)

sum(abcd.data.noNA$sex=="M",na.rm=TRUE)
round(mean(abcd.data.noNA[abcd.data.noNA$sex=="M",]$acceptance,na.rm=TRUE),2)
round(sd(abcd.data.noNA[abcd.data.noNA$sex=="M",]$acceptance,na.rm=TRUE),2)
round(mean(abcd.data.noNA[abcd.data.noNA$sex=="M",]$monitoring,na.rm=TRUE),2)
round(sd(abcd.data.noNA[abcd.data.noNA$sex=="M",]$monitoring,na.rm=TRUE),2)
```



# Repeat of all analyses within each race category separately:
```{r}
# Race 6 level (1: White | 2: Black | 3: Asian | 4: AIAN/NHPI | 5: Other | 6: Mixed)
summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+acceptance+monitoring,data=abcd.data[abcd.data$race.6level=="Black",]))
summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+acceptance+monitoring,data=abcd.data[abcd.data$race.6level=="Black",])) # does not replicate
summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+acceptance+monitoring,data=abcd.data[abcd.data$race.6level=="Black",])) # does not replicate

summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+acceptance+monitoring,data=abcd.data[abcd.data$race.6level=="White",]))
summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+acceptance+monitoring,data=abcd.data[abcd.data$race.6level=="White",]))
summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+acceptance+monitoring,data=abcd.data[abcd.data$race.6level=="White",]))

summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+acceptance+monitoring,data=abcd.data[abcd.data$race.6level=="Asian",]))
summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+acceptance+monitoring,data=abcd.data[abcd.data$race.6level=="Asian",])) # does not replicate
summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+acceptance+monitoring,data=abcd.data[abcd.data$race.6level=="Asian",])) # does not replicate

summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+acceptance+monitoring,data=abcd.data[abcd.data$race.6level=="AIAN/NHPI",])) # not enough subjects
summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+acceptance+monitoring,data=abcd.data[abcd.data$race.6level=="AIAN/NHPI",])) # not enough subjects
summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+acceptance+monitoring,data=abcd.data[abcd.data$race.6level=="AIAN/NHPI",])) # not enough subjects

summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+acceptance+monitoring,data=abcd.data[abcd.data$race.6level=="Other",]))
summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+acceptance+monitoring,data=abcd.data[abcd.data$race.6level=="Other",])) # does not replicate
summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+acceptance+monitoring,data=abcd.data[abcd.data$race.6level=="Other",])) # does not replicate

summary(lmer(thompson_PC1~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+acceptance+monitoring,data=abcd.data[abcd.data$race.6level=="Mixed",]))
summary(lmer(thompson_PC2~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+acceptance+monitoring,data=abcd.data[abcd.data$race.6level=="Mixed",]))
summary(lmer(thompson_PC3~interview_age+sex+(1|rel_family_id)+(1|abcd_site)+acceptance+monitoring,data=abcd.data[abcd.data$race.6level=="Mixed",]))
```

